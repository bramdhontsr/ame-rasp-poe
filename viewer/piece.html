<!doctype html>
<meta charset="utf-8">
<title>AME Piece Viewer</title>
<style>
  html,body{margin:0;height:100%}
  body{display:flex;align-items:center;justify-content:center}
  .box{width:256px;height:256px;display:flex;align-items:center;justify-content:center}
  img,iframe{width:256px;height:256px;border:0;display:block}
</style>
<div class="box" id="box"></div>
<script>
  (function () {
    const u = new URL(location.href);
    const box = document.getElementById('box');

    // siteBase = "/ame-rasp-poe/" (eerste padsegment)
    const segs = location.pathname.split("/").filter(Boolean);
    const siteBase = (segs.length ? "/" + segs[0] + "/" : "/");

    function resolvePath(p) {
      if (!p) return null;
      if (/^https?:\/\//i.test(p)) return p;   // absolute URL
      if (p.startsWith("/")) return p;         // site-absolute
      return siteBase + p;                     // relative => onder repo-root
    }

    const imgSrcRaw = u.searchParams.get("img");
    const n = u.searchParams.get("n");
    const L = u.searchParams.get("L") || "8";
    const bust = Date.now();

    if (imgSrcRaw) {
      const img = new Image();
      img.decoding = "async";
      img.loading = "eager";
      img.src = resolvePath(imgSrcRaw) + "?_=" + bust; // cache-bust
      box.appendChild(img);
      return;
    }

    // val terug op JS-render via widgets/image.html
    const seed = n ?? "42";
    const ifr = document.createElement("iframe");
    ifr.src = siteBase + "widgets/image.html?n=" + encodeURIComponent(seed) + "&L=" + encodeURIComponent(L) + "&v=" + bust;
    box.appendChild(ifr);
  })();
</script>
